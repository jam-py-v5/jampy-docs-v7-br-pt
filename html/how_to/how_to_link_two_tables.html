<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to link two tables &mdash; Jam.py  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
    <link rel="canonical" href="https://jampyapplicationbuilder.com/docs/how_to/how_to_link_two_tables.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=a354a556"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9bcbadda"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How change field value of selected records" href="how_change_field_value_of_selected_records.html" />
    <link rel="prev" title="How to prohibit changing record" href="how_to_prohibit_changing_record.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../contents.html" class="icon icon-home"> Jam.py
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Jam.py V7 documentation</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programming/index.html">Jam.py programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">Jam.py FAQ</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">How to</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="how_to_install_on_windows.html">How to install Jam.py on Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_implement_a_many-to-many_relationship.html">How to implement a many-to-many relationship</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_migrate_development_to_production.html">How to migrate development to production</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_migrate_to_another_database.html">How to migrate to another database</a></li>
<li class="toctree-l2"><a class="reference internal" href="deploy/index.html">How to deploy</a></li>
<li class="toctree-l2"><a class="reference internal" href="global_scripts.html">How do I write functions which have a global scope</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_validate_field_value.html">How to validate field value</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_add_a_button_to_a_form.html">How to add a button to a form</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_execute_script_from_client.html">How to execute script from client</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_change_style_and_attributes_of_elements.html">How to change style and attributes of form elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_create_a_custom_menu.html">How to create a custom menu</a></li>
<li class="toctree-l2"><a class="reference internal" href="to_append_a_record_without_view_form.html">How to append a record using an edit form without opening a view form?</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_prohibit_changing_record.html">How to prohibit changing record</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">How to link two tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_change_field_value_of_selected_records.html">How change field value of selected records</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_save_edit_form_without_closing_it.html">How to save edit form without closing it</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_save_changes_to_two_tables_in_same_transaction.html">How to save changes to two tables in same transaction on the server</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_prevent_duplicate_values.html">How to prevent duplicate values in a table field</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_multitenancy.html">How to implement some sort of basic multi-tenancy? For example, to have users with separate data.</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_use_jam_py_with_existing_database.html">Can I use Jam.py with existing database</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_data_from_other_database_tables.html">How can I use data from other database tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_request_from_other_application.html">How I can process a request or get some data from other application or service</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_calculations_in_the_background.html">How can I perform calculations in the background</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_details_inside_details.html">Is it supported to have details inside details?</a></li>
<li class="toctree-l2"><a class="reference internal" href="export_import_csv_files.html">Export to / import from csv files</a></li>
<li class="toctree-l2"><a class="reference internal" href="authentication/index.html">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_migrate_to_v7.html">How to migrate v5 project to v7</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../admin/index.html">Business application builder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../refs/index.html">Jam.py class reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/index.html">Release notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../contents.html">Jam.py</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../contents.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">How to</a> &raquo;</li>
      <li>How to link two tables</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="how-to-link-two-tables">
<h1>How to link two tables<a class="headerlink" href="#how-to-link-two-tables" title="Link to this heading">¶</a></h1>
<p>We’ll explain how to link two items on example of the tracks and invoicetable items
from the demo application. We’ll link the record of tracks with the corresponding
list of sold tracks from invoicetable that contains all sold tracks from invoices.</p>
<p>The default behavior if
<a class="reference internal" href="../refs/client/item/at_view_form.html"><span class="doc">view_form</span></a>
is defined in the
<a class="reference internal" href="../refs/client/task/on_view_form_created.html"><span class="doc">on_view_form_created</span></a>
event handler declared in the task client module.</p>
<p>We will change it in the
<a class="reference internal" href="../refs/client/item/on_view_form_created.html"><span class="doc">on_view_form_created</span></a>
event handler in the tracks client module</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">on_view_form_created</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">item</span><span class="o">.</span><span class="n">table_options</span><span class="o">.</span><span class="n">height</span> <span class="o">-=</span> <span class="mi">200</span><span class="p">;</span>
  <span class="n">item</span><span class="o">.</span><span class="n">invoice_table</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">invoice_table</span><span class="o">.</span><span class="n">copy</span><span class="p">();</span>
  <span class="n">item</span><span class="o">.</span><span class="n">invoice_table</span><span class="o">.</span><span class="n">paginate</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span>
  <span class="n">item</span><span class="o">.</span><span class="n">invoice_table</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">view_form</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.view-detail&#39;</span><span class="p">),</span> <span class="p">{</span>
      <span class="n">height</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
      <span class="n">summary_fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">],</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then we reduce height of the table that displays tracks data by 200 pixels</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">item</span><span class="o">.</span><span class="n">table_options</span><span class="o">.</span><span class="n">height</span> <span class="o">-=</span> <span class="mi">200</span><span class="p">;</span>
</pre></div>
</div>
<p>create a
<a class="reference internal" href="../refs/client/item/m_copy.html"><span class="doc">copy</span></a>
of invoice_table, set its
<a class="reference internal" href="../refs/client/item/at_paginate.html"><span class="doc">paginate</span></a> attribute to false and call the
<a class="reference internal" href="../refs/client/item/m_create_table.html"><span class="doc">create_table</span></a>
method to create a table that will display the sold tracks</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">item</span><span class="o">.</span><span class="n">invoice_table</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">invoice_table</span><span class="o">.</span><span class="n">copy</span><span class="p">();</span>
<span class="n">item</span><span class="o">.</span><span class="n">invoice_table</span><span class="o">.</span><span class="n">paginate</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span>
<span class="n">item</span><span class="o">.</span><span class="n">invoice_table</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">view_form</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.view-detail&#39;</span><span class="p">),</span> <span class="p">{</span>
    <span class="n">height</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
    <span class="n">summary_fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">],</span>
<span class="p">});</span>
</pre></div>
</div>
<p>For this table we set the height to 200 pixels and define to summary fields.</p>
<p>This table will always be empty if we won’t define the following
<a class="reference internal" href="../refs/client/item/on_after_scroll.html"><span class="doc">on_after_scroll</span></a>
event handler:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">on_after_scroll</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">view_form</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">rec_count</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">item</span><span class="o">.</span><span class="n">invoice_table</span><span class="o">.</span><span class="n">set_where</span><span class="p">({</span><span class="n">track</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">value</span><span class="p">});</span>
          <span class="n">item</span><span class="o">.</span><span class="n">invoice_table</span><span class="o">.</span><span class="n">set_order_by</span><span class="p">([</span><span class="s1">&#39;-invoice_date&#39;</span><span class="p">]);</span>
          <span class="n">item</span><span class="o">.</span><span class="n">invoice_table</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">true</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
          <span class="n">item</span><span class="o">.</span><span class="n">invoice_table</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The
<a class="reference internal" href="../refs/client/item/on_after_scroll.html"><span class="doc">on_after_scroll</span></a>
event is triggered whenever the current record is changed.
So when the track is changed we call
<a class="reference internal" href="../refs/client/item/m_open.html"><span class="doc">open</span></a>
method, pre-setting the filter and order</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">item</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">set_where</span><span class="p">({</span><span class="nx">track</span><span class="o">:</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">value</span><span class="p">});</span>
<span class="nx">item</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">set_order_by</span><span class="p">([</span><span class="s1">&#39;-invoice_date&#39;</span><span class="p">]);</span>
<span class="nx">item</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</pre></div>
</div>
<p>This method sends a request to the server, that generates sql query, executes it
and returns a dataset that contains sold records of this track ordered in
descending order of invoice_date field.</p>
<p>If the tracks dataset is empty we clear the sold records dataset by calling the
<a class="reference internal" href="../refs/client/item/m_close.html"><span class="doc">close</span></a>
method.</p>
<p>Because controls in Jam.py are data-aware every change of sold records dataset
will be displayed in the table that we created in the
<a class="reference internal" href="../refs/client/item/on_view_form_created.html"><span class="doc">on_view_form_created</span></a>
event handler.</p>
<p>Now every time the track has changed the application send request to the server
to renew the sold tracks. This is not effective and sometimes can lead to
delays. To avoid this we use the JavaScript setTimeout function:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">scroll_timeout</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">on_after_scroll</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">item</span><span class="p">.</span><span class="nx">lookup_field</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">view_form</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">scroll_timeout</span><span class="p">);</span>
<span class="w">        </span><span class="nx">scroll_timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span>
<span class="w">            </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">rec_count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">item</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">set_where</span><span class="p">({</span><span class="nx">track</span><span class="o">:</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">value</span><span class="p">});</span>
<span class="w">                    </span><span class="nx">item</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">set_order_by</span><span class="p">([</span><span class="s1">&#39;-invoice_date&#39;</span><span class="p">]);</span>
<span class="w">                    </span><span class="nx">item</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">item</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="mf">100</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This function guarantees that the data will be updated no more than
once every 100 milliseconds.</p>
<p>Since the invoicetable is a
<a class="reference internal" href="../programming/data/details.html"><span class="doc">detail</span></a> it has the master_rec_id field that
stores a reference to invoice that has this record, we can show the user an
invoice that contains the current sold record.
To do so we pass to the
<a class="reference internal" href="../refs/client/item/m_create_table.html"><span class="doc">create_table</span></a>
method the function that will be executed
when user double click the record:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">item</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">create_table</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">view_form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.view-detail&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="mf">200</span><span class="p">,</span>
<span class="w">    </span><span class="nx">summary_fields</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;total&#39;</span><span class="p">],</span>
<span class="w">    </span><span class="nx">on_dblclick</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">show_invoice</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>and define the function as follows:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="w"> </span><span class="nx">show_invoice</span><span class="p">(</span><span class="nx">invoice_table</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">invoices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">invoices</span><span class="p">.</span><span class="nx">copy</span><span class="p">();</span>
<span class="w">    </span><span class="nx">invoices</span><span class="p">.</span><span class="nx">set_where</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">master_rec_id</span><span class="p">.</span><span class="nx">value</span><span class="p">});</span>
<span class="w">    </span><span class="nx">invoices</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">i</span><span class="p">.</span><span class="nx">edit_options</span><span class="p">.</span><span class="nx">modeless</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="nx">i</span><span class="p">.</span><span class="nx">can_modify</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="nx">i</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">on_after_open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">t</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="nx">i</span><span class="p">.</span><span class="nx">edit_record</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this function we create a copy of the invoices journal and find the invoice.
When the open method is executed we will show the invoice by calling its
<a class="reference internal" href="../refs/client/item/m_edit_record.html"><span class="doc">edit_record</span></a>
method. But before calling it we set its attributes so that it will be modal and
the user won’t be able to modify it.</p>
<p>Besides we dynamically assign
<a class="reference internal" href="../refs/client/item/on_after_open.html"><span class="doc">on_after_open</span></a>
event handler to the invoice_table detail of the invoice we get.
In this event handler we will find the current record in the sold records by
calling the
<a class="reference internal" href="../refs/client/item/m_locate.html"><span class="doc">locate</span></a>
method.</p>
<p>Finally we will check the
<a class="reference internal" href="../refs/client/item/at_lookup_field.html"><span class="doc">lookup_field</span></a>
attribute of tracks. This attribute is true if the item was created to select
a value for the lookup field when a user clicks on the button to the right of
lookup field input. We will make so that the sold tracks are not shown when the
user selects the value for the lookup field.</p>
<p>In addition, we add an alert informing the user about the possibility of seeing
the invoice.</p>
<p>Finally the code of the
<a class="reference internal" href="../refs/client/item/on_view_form_created.html"><span class="doc">on_view_form_created</span></a>
will be as follows:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="w"> </span><span class="nx">on_view_form_created</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">item</span><span class="p">.</span><span class="nx">lookup_field</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">item</span><span class="p">.</span><span class="nx">table_options</span><span class="p">.</span><span class="nx">height</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mf">200</span><span class="p">;</span>
<span class="w">        </span><span class="nx">item</span><span class="p">.</span><span class="nx">invoice_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">copy</span><span class="p">();</span>
<span class="w">        </span><span class="nx">item</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">paginate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="nx">item</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">create_table</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">view_form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.view-detail&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="mf">200</span><span class="p">,</span>
<span class="w">            </span><span class="nx">summary_fields</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;total&#39;</span><span class="p">],</span>
<span class="w">            </span><span class="nx">on_dblclick</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">show_invoice</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="nx">item</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Double-click the record in the bottom table &#39;</span><span class="w"> </span><span class="o">+</span>
<span class="w">          </span><span class="s1">&#39;to see the invoice in which the track was sold.&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">scroll_timeout</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">on_after_scroll</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">item</span><span class="p">.</span><span class="nx">lookup_field</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">view_form</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">scroll_timeout</span><span class="p">);</span>
<span class="w">        </span><span class="nx">scroll_timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span>
<span class="w">            </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">rec_count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">item</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">set_where</span><span class="p">({</span><span class="nx">track</span><span class="o">:</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">value</span><span class="p">});</span>
<span class="w">                    </span><span class="nx">item</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">set_order_by</span><span class="p">([</span><span class="s1">&#39;-invoice_date&#39;</span><span class="p">]);</span>
<span class="w">                    </span><span class="nx">item</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">item</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="mf">100</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">show_invoice</span><span class="p">(</span><span class="nx">invoice_table</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">invoices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">invoices</span><span class="p">.</span><span class="nx">copy</span><span class="p">();</span>
<span class="w">    </span><span class="nx">invoices</span><span class="p">.</span><span class="nx">set_where</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">master_rec_id</span><span class="p">.</span><span class="nx">value</span><span class="p">});</span>
<span class="w">    </span><span class="nx">invoices</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">i</span><span class="p">.</span><span class="nx">edit_options</span><span class="p">.</span><span class="nx">modeless</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="nx">i</span><span class="p">.</span><span class="nx">can_modify</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="nx">i</span><span class="p">.</span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">on_after_open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">t</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">invoice_table</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="nx">i</span><span class="p">.</span><span class="nx">edit_record</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<img alt="two_tables_jampy.png" class="align-center" src="../_images/two_tables_jampy.png" />
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="how_to_prohibit_changing_record.html" class="btn btn-neutral float-left" title="How to prohibit changing record" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="how_change_field_value_of_selected_records.html" class="btn btn-neutral float-right" title="How change field value of selected records" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Jam.py Team.
      <span class="lastupdated">Last updated on Feb 07, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-122962025-6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-122962025-6', {
          'anonymize_ip': false,
      });
    </script>  

  <style>
         .wy-nav-content { max-width: none; }
  </style>



</body>
</html>